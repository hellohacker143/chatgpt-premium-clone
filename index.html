<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Calendar Search - Table, Stats & Summary</title>
  <style>
    body { font-family: sans-serif; background: #f4f8fc; }
    .container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 20px; box-shadow: 0 8px 32px #eee; padding: 36px; }
    .row { margin-bottom: 20px; }
    .quick-topics button { margin-right: 10px; margin-bottom: 10px; padding: 10px 22px; border-radius: 12px; border:none; font-weight:600; background: linear-gradient(90deg, #667eea 30%, #f8a 100%); color:#fff; cursor:pointer; box-shadow:0 2px 10px #eec; }
    .quick-topics button:hover { background: linear-gradient(90deg, #764ba2 30%, #e22 100%); }
    .calendar-row label, .calendar-row select, .calendar-row input { margin-right: 14px; }
    table { width:100%; border-collapse:collapse; margin-top:24px; background:#f9faff; border-radius:12px; box-shadow:0 8px 24px #eef; overflow:hidden;}
    th, td { padding:8px 10px; text-align:left;}
    th { background:#dbeafe;}
    tr:nth-child(even) { background: #f4f8fc; }
    .player { margin-top: 35px; text-align: center; }
    #summary-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 24px; margin: 18px auto 0; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); max-width:700px; color: #fff; text-align: left; }
    #summary-card h3 { color: #fff; margin-top: 0; font-size: 1.5em; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px; }
    #summary-content { line-height: 1.8; font-size: 1.05em; white-space: pre-wrap; }
    #suggest-list .suggested-video { margin-bottom:10px; text-align:left;}
    #suggest-list img { border-radius:5px; margin-right:10px;}
  </style>
</head>
<body>
  <div class="container">
    <h2>YouTube Calendar Search <small>(Table, Stats & Summary)</small></h2>
    <div class="row quick-topics">
      <button onclick="quickTopic('ChatGPT Updates')">ChatGPT Updates</button>
      <button onclick="quickTopic('Perplexity Updates')">Perplexity Updates</button>
      <button onclick="quickTopic('Gemini Updates')">Gemini Updates</button>
      <button onclick="quickTopic('Comedy Telugu')">Comedy Telugu</button>
    </div>
    <div class="row calendar-row">
      <label><input type="radio" name="range" id="rToday" checked> Today (24h)</label>
      <label><input type="radio" name="range" id="rYesterday"> Yesterday</label>
      <label><input type="radio" name="range" id="rWeek"> This Week</label>
      <label><input type="radio" name="range" id="rDate"> Date:</label>
      <input type="date" id="datePick" style="margin-right:30px;">
      <label>Year:</label>
      <select id="yearPick"></select>
    </div>
    <div class="row"><input type="text" id="query" style="width:60%;" placeholder="Enter topic (e.g. gaming, news)"> <button onclick="searchVideos()">Search</button></div>
    <div id="results"></div>
    <div id="player" class="player"></div>
    <div id="suggest-list"></div>
  </div>
  <script>
    const API_KEY = 'AIzaSyBrkLUjSB2vamhcdeXWHZsf-cZBkQ-LkPg';
    const GEMINI_API_KEY = 'AIzaSyB2hOYT6OhVt6RfIVbU8UGpxw98a_QCcyU';
    // Setup years dropdown
    const yearSel = document.getElementById('yearPick');
    for(let y = 2015; y <= new Date().getFullYear(); y++) {
      let opt = document.createElement('option');
      opt.value = y; opt.text = y;
      yearSel.appendChild(opt);
    }
    yearSel.value = new Date().getFullYear();
    function getDates() {
      let publishedAfter = '', publishedBefore = '';
      let now = new Date(), range = 'today';
      if(document.getElementById('rYesterday').checked) {
        range = 'yesterday';
        let prev = new Date(now.getTime()-24*60*60*1000);
        publishedAfter = prev.toISOString().slice(0,10) + 'T00:00:00Z';
        publishedBefore = prev.toISOString().slice(0,10) + 'T23:59:59Z';
      } else if(document.getElementById('rWeek').checked) {
        range = 'week';
        let weekStart = new Date(now.getTime() - 6*24*60*60*1000);
        publishedAfter = weekStart.toISOString().slice(0,10) + 'T00:00:00Z';
        publishedBefore = now.toISOString();
      } else if(document.getElementById('rDate').checked){
        let date = document.getElementById('datePick').value;
        if (!date) return null;
        publishedAfter = date + 'T00:00:00Z'; publishedBefore = date + 'T23:59:59Z';
      } else if(yearSel) {
        if(document.getElementById('yearPick').value) {
          range = 'year';
          let year = document.getElementById('yearPick').value;
          publishedAfter = `${year}-01-01T00:00:00Z`;
          publishedBefore = `${year}-12-31T23:59:59Z`;
        }
      } else {
        // Today (24h)
        let prev = new Date(now.getTime()-24*60*60*1000);
        publishedAfter = prev.toISOString();
        publishedBefore = now.toISOString();
      }
      return {publishedAfter, publishedBefore};
    }
    function searchVideos(topic=null) {
      let q = topic || document.getElementById('query').value;
      if (!q) q = 'trending';
      let dateObj = getDates();
      if (!dateObj) return alert("Please select a valid date.");
      let {publishedAfter, publishedBefore} = dateObj;
      fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=8&q=${encodeURIComponent(q)}&key=${API_KEY}&publishedAfter=${publishedAfter}&publishedBefore=${publishedBefore}`)
        .then(r=>r.json())
        .then(data => {
          if (data.items && data.items.length) {
            let ids = data.items.map(it=>it.id.videoId).join(',');
            // Get stats for each video
            fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${ids}&key=${API_KEY}`)
              .then(r=>r.json())
              .then(statData=>{
                showTable(statData.items);
              });
          } else {
            document.getElementById('results').innerHTML = '<p>No videos found for your selection.</p>';
            document.getElementById('player').innerHTML = '';
            document.getElementById('suggest-list').innerHTML = '';
          }
        });
    }
    function showTable(items){
      let html = `<table><tr>
        <th>Thumbnail</th>
        <th>Title</th>
        <th>Channel</th>
        <th>Views</th>
        <th>Published</th>
        <th>Suggest</th>
      </tr>`;
      items.forEach((item, i) => {
        html += `<tr>
          <td><img src="${item.snippet.thumbnails.default.url}" width="80" style="cursor:pointer;" onclick="playVideo('${item.id}', '${item.snippet.title}')"></td>
          <td><a href="#" onclick="playVideo('${item.id}', '${item.snippet.title}')">${item.snippet.title}</a></td>
          <td>${item.snippet.channelTitle}</td>
          <td>${item.statistics.viewCount}</td>
          <td>${item.snippet.publishedAt.slice(0,10)}</td>
          <td><button onclick="suggestVideos('${item.id}')">Suggest</button></td>
        </tr>`;
      });
      html += `</table>`;
      document.getElementById('results').innerHTML = html;
      document.getElementById('player').innerHTML = '';
      document.getElementById('suggest-list').innerHTML = '';
    }
    async function playVideo(vidId, title) {
      document.getElementById('player').innerHTML = `
        <iframe width="560" height="315" src="https://www.youtube.com/embed/${vidId}?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        <div id="summary-card">
          <h3>Blog Summary for "${title}"</h3>
          <div id="summary-content">Loading summary from Gemini AI...</div>
        </div>
      `;
      document.getElementById('suggest-list').innerHTML = '';
      document.getElementById('player').scrollIntoView({behavior:'smooth'});
      
      // Fetch video description from YouTube API
      try {
        const videoResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${vidId}&key=${API_KEY}`);
        const videoData = await videoResponse.json();
        
        if (videoData.items && videoData.items.length > 0) {
          const description = videoData.items[0].snippet.description || 'No description available.';
          
          // Send description to Gemini API for blog-style summary
          const geminiResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              contents: [{
                parts: [{
                  text: `Create a compelling blog-style summary based on this YouTube video information:\n\nTitle: ${title}\n\nDescription: ${description}\n\nWrite an engaging 3-4 paragraph blog summary that captures the key points, insights, and value of this video content. Make it informative and reader-friendly.`
                }]
              }]
            })
          });
          
          const geminiData = await geminiResponse.json();
          
          if (geminiData.candidates && geminiData.candidates[0]) {
            const summary = geminiData.candidates[0].content.parts[0].text;
            document.getElementById('summary-content').innerHTML = summary;
          } else {
            document.getElementById('summary-content').innerHTML = 'Unable to generate summary. Please try again.';
          }
        } else {
          document.getElementById('summary-content').innerHTML = 'Video details not found.';
        }
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('summary-content').innerHTML = 'Error generating summary: ' + error.message;
      }
    }
    function suggestVideos(videoId) {
      fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&relatedToVideoId=${videoId}&maxResults=5&key=${API_KEY}`)
        .then(r=>r.json())
        .then(data=>{
          let html = `<h3>Suggested/Related Videos:</h3>`;
          data.items.forEach(item=>{
            html += `<div class="suggested-video">
                <img src="${item.snippet.thumbnails.default.url}" width="60" onclick="playVideo('${item.id.videoId}', '${item.snippet.title}')">
                <span style="font-weight:600">${item.snippet.title}</span> <span style="color:#888;">(${item.snippet.channelTitle})</span>
            </div>`;
          });
          document.getElementById('suggest-list').innerHTML = html;
        });
    }
    function quickTopic(topic) {
      document.getElementById('query').value = topic;
      searchVideos(topic);
    }
    // set default to today
    document.getElementById('rToday').checked = true;
  </script>
</body>
</html>
